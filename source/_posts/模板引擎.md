---
title: 模板引擎
date: 2018-11-04 16:08:11
tags:
---

### 一、模板
模板通常是指嵌入了某种动态编程语言代码的文本。数据和模板通过某种形式的结合，可以变化出不同的结果。
#### 原理
模板的诞生是为了将显示与数据分离，模板技术多种多样，但其本质是将模板文件和数据通过模板引擎生成最终的HTML代码。模板技术并不是什么神秘技术，干的是拼接字符串的体力活。模板引擎就是利用正则表达式识别模板标识，并利用数据替换其中的标识符。
<!-- more -->
#### 特点
1.简化了html的书写
2.通过编程元素（比如循环和条件分支），对数据的展现更具有控制的能力
3.分离了数据与展现，使得展现的逻辑和效果更易维护

### 二、模板引擎
通过分析模板，将数据和模板结合在一起输出最后的结果的程序称为模板引擎。一种比较古老的模板称为ERB，在很多的web框架中被采用。在ERB中两个核心的概念：evaluate和interpolate。表面上evaluate是指包含在<% %>中的部分，interpolate是指包含在<%= %>中的部分。从模板引擎的角度，evaluate中的部分不会直接输出到结果中，一般用于过程控制；而interpolate中的部分将直接输出到结果中。
#### 模板转化：
如果能够将模板的文本变成代码执行，那么就能实现模板转化。转化过程中遵循的原则：
``` bash
遇到普通的文本直接当成字符串拼接，遇到interpolate(即<%= %>)，将其中的内容当成变量拼接在字符串中，遇到evaluate(即<% %>)，直接当成代码
```
#### 引擎核心：
1.利用正则表达式分解出普通字符串和模板标识符
2.将模板标识符转换成普通的语言表达式
3.生成待执行语句
4.将数据填入执行，生成最终的字符串

#### 引擎缺点：
在单页应用开发的时候，前端模板引擎的数据如果要利用ajax从服务器端获取，那么这个ajax就不能是异步的了，而且必须是整个单例中最先加载的才行。因此对于单页应用开发，模板引擎只能做首屏数据渲染，所有的异步操作都是无法应用模板引擎的（当然如果你手动调用模板函数也是可以做到的）。

### 三、模板编译
为了能够与数据一起执行生成字符串，我们需要将原始的模板字符串转换成一个函数对象。这个过程称为模板编译。模板编译的核心是使用 new Function()